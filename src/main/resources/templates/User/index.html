<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3" ng-app="messagingApp"
      ng-controller="userController">
<th:block th:replace="fragment/User/top">
</th:block>

<!-- Sidebar -->
<div class="col-xs-7 col-sm-3 col-md-3 sidebar sidebar-left sidebar-animate sidebar-md-show">
    <ul class="nav navbar-stacked">
        <select class="form-control" ng-model="typemsg" ng-init="typemsg=typemessages[0]"
                ng-options="t as t.name for t in typemessages"
                ng-change="switchTypeMessage(typemsg)">
        </select>

        <div ng-if="typemsgselected == 'Individual'">
            <li ng-repeat="user in users" ng-click="displayMessages(user)" ng-init="displayFirstMessage(user)">
                <a href="#">{{user.firstName}} {{user.lastName}}</a>
            </li>
        </div>

        <div ng-if="typemsgselected == 'Team'">
            <li ng-repeat="team in teams" ng-click="getTeamMessages(team)" ng-init="getTeamMessages(team)">
                <a href="#">{{team.teamName}}</a>
            </li>
        </div>
    </ul>
</div>
<!-- end of sidebar -->

<div id="page-content-wrapper">
    <div class="container-fluid">

        <th:block th:replace="User/modals">
        </th:block>


        <div class="row">
            <!-- Messages column -->
            <div class="col-md-6 col-md-offset-2">

                <!-- Div containing individual messages -->
                <div ng-if="typemsgselected == 'Individual'">
                    <div class="row message-row" ng-repeat="message in messages">
                        <!-- Applies the offset class and sender-message class in case that the message is not from the current logged in user -->
                        <div class="message col-md-8"
                             ng-class="nameStartsWith(currentName, message.fromFirstName) ? 'col-md-offset-10 sender' : 'receiver'">
                            <h4>{{message.fromFirstName}}
                                <small>{{message.prettyTime}}</small>
                            </h4>
                            {{message.message}}
                            <div ng-if="message.fileName != 'null'">Attached Files: <a
                                    ng-attr-href="/user/download/file/?fileName={{message.fileName}}">{{message.fileName}}</a>
                            </div>
                        </div>
                    </div> <!-- end message repeat -->

                    <!-- Messages exchanged between two users -->
                    <div class="row send-message-row">
                        <div class="col-md-8 col-md-offset-4">
                            <form id='sendIndividualMessageForm'>
                                <label class="control-label">Enter Message here:</label>
                                <input style='display: none' ng-value="currentUserId" type="text" id="itoUserId"
                                       name="toUserId">
                                <div class="input-group">
                                    <input ng-model="message.ind" type="text" class="form-control" id="imessage"
                                           name="message">
                                    <span class="input-group-btn"><button ng-click="sendIndMessage()" id='sendIndMsgButton' type="submit"
                                                                          class="btn btn-default">Send to
                                        {{currentName}}
                                    </button></span>
                                </div>

                                <div class="text-center"><a ng-click="showFileUpload = !showFileUpload">Add file</a>
                                    <input ng-show="showFileUpload" type="file" name="fileUpload" id="fileUpload">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- end of div containing individual messages -->

                <!-- Div containing team messages -->
                <div ng-if="typemsgselected == 'Team'">
                    <div id="teamMsgs" class="row message-row" ng-repeat="message in teammessages">
                        <!-- Applies the offset class and sender-message class in case that the message is not from the current logged in user -->
                        <div class="message col-md-8"
                             ng-class="nameStartsWith(currentName, message.fromFirstName) ? 'col-md-offset-10 sender' : 'receiver'">
                            <h4>{{message.fromFirstName}}
                                <small>{{message.prettyTime}}</small>
                            </h4>
                            {{message.message}}
                            <div ng-if="message.fileName != null">Attached Files: <a
                                    ng-attr-href="/user/download/file/?fileName={{message.fileName}}">{{message.fileName}}</a>
                            </div>
                        </div>
                    </div> <!-- end message repeat -->

                    <!--send team message-->
                    <div ng-if="teams.length > 0" class="row send-message-row">
                        <div class="col-md-8 col-md-offset-4">
                            <form id='teamMessageForm'>
                                <label class="control-label">Enter Message:</label>
                                <input style="display: none" id="ttoTeamId" ng-value="currentTeam.teamId" type="text"
                                       name="toTeamId">
                                <div class="input-group">
                                    <input ng-model="currentMessage" type="text" class="form-control" id="tmessage"
                                           name="message">

                        <span class="input-group-btn">
                            <button ng-click="sendTeamMessageFunc()" type="submit" id='teamMsgButton' class="btn btn-default">Send to {{currentTeam.teamName}}</button>
                        </span>
                                </div>

                                <div class="text-center"><a ng-click="showFileUpload = !showFileUpload">Add file</a>
                                    <input ng-show="showFileUpload" type="file" name="fileUpload" id="fileUpload">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- end of div containing team messages -->

            </div> <!-- end Messages column -->
        </div> <!-- end row -->

    </div>
</div>

<th:block th:replace="fragment/User/bottom">

</th:block>
