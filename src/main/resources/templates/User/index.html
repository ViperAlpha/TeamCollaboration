<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3" ng-app="messagingApp"
      ng-controller="userController">
<th:block th:replace="fragment/User/top">
</th:block>

<th:block th:replace="fragment/User/sidebar"></th:block>

<div id="page-content-wrapper">
    <div class="container-fluid">

        <th:block th:replace="fragment/User/modals"></th:block>


        <div class="row">
            <!-- Messages column -->
            <div class="col-md-6 col-md-offset-2">

                <!-- Div containing individual messages -->
                <div ng-if="typemsgselected == 'Individual'">
                    <div class="row message-row" ng-repeat="message in messages">
                        <!-- Applies the offset class and sender-message class in case that the message is not from the current logged in user -->
                        <div class="message col-md-8"
                             ng-class="nameStartsWith(currentName, message.fromFirstName) ? 'col-md-offset-10 sender' : 'receiver'">
                            <h4>{{message.fromFirstName}}
                                <small>{{message.prettyTime}}</small>
                            </h4>
                            {{message.message}}
                            <div ng-if="message.fileName != 'null'">Attached Files: <a
                                    ng-attr-href="/user/download/file/?fileName={{message.fileName}}">{{message.fileName}}</a>
                            </div>
                        </div>
                    </div> <!-- end message repeat -->
                </div>
                <!-- end of div containing individual messages -->

                <!-- Div containing team messages -->
                <div ng-if="typemsgselected == 'Team'">
                    <div id="teamMsgs" class="row message-row" ng-repeat="message in teammessages">
                        <!-- Applies the offset class and sender-message class in case that the message is not from the current logged in user -->
                        <div class="message col-md-8"
                             ng-class="nameStartsWith(currentName, message.fromFirstName) ? 'col-md-offset-10 sender' : 'receiver'">
                            <h4>{{message.fromFirstName}}
                                <small>{{message.prettyTime}}</small>
                            </h4>
                            {{message.message}}
                            <div ng-if="message.fileName != null">Attached Files: <a
                                    ng-attr-href="/user/download/file/?fileName={{message.fileName}}">{{message.fileName}}</a>
                            </div>
                        </div>
                    </div> <!-- end message repeat -->

                    <!--send team message-->
                    <div ng-if="teams.length > 0" class="row send-message-row">
                        <div class="col-md-8 col-md-offset-4">
                            <form id='teamMessageForm'>
                                <label class="control-label">Enter Message:</label>
                                <input style="display: none" id="ttoTeamId" ng-value="currentTeam.teamId" type="text"
                                       name="toTeamId">
                                <div class="input-group">
                                    <input ng-model="currentMessage" type="text" class="form-control" id="tmessage"
                                           name="message">

                        <span class="input-group-btn">
                            <button ng-click="sendTeamMessageFunc()" type="submit" id='teamMsgButton'
                                    class="btn btn-default">Send to {{currentTeam.teamName}}</button>
                        </span>
                                </div>

                                <div class="text-center"><a ng-click="showFileUpload = !showFileUpload">Add file</a>
                                    <input ng-show="showFileUpload" type="file" name="fileUpload" id="fileUpload">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- end of div containing team messages -->

            </div> <!-- end Messages column -->

        </div> <!-- end row -->

        <div class="row">
            <hr>

            <div class="col-md-8 col-md-offset-1">
                <!-- Messages exchanged between two users -->
                <div class="row send-message-row">
                    <div class="col-md-8 col-md-offset-4">
                        <div class="panel panel-primary">
                            <div class="panel-heading">
                                <h3 class="panel-title">Write a reply</h3>
                            </div>
                            <div class="panel-body">
                                <form class="form-horizontal" id='sendIndividualMessageForm'>
                                    <!--<label class="control-label">Enter Message here:</label>-->
                                    <div class="form-group">
                                        <input style='display: none' ng-value="currentUserId" type="text" id="itoUserId"
                                               name="toUserId">
                                        <!--<input ng-model="message.ind" type="text" class="form-control" id="imessage"-->
                                        <!--name="message">-->
                                        <textarea class="form-control" rows="3" ng-model="message.ind" id="imessage"
                                                  name="message"></textarea>
                                    </div>

                                    <div class="text-center">
                                        <button type="button" class="btn btn-default" ng-click="showFileUpload = !showFileUpload">
                                            <span class="glyphicon glyphicon-paperclip" aria-hidden="true"></span> Add
                                            file
                                        </button>
                                        <input ng-show="showFileUpload" type="file" name="fileUpload" id="fileUpload">
                                    </div>

                                    <!--<div class="text-center"><a ng-click="showFileUpload = !showFileUpload">Add file</a>-->
                                        <!--<input ng-show="showFileUpload" type="file" name="fileUpload" id="fileUpload">-->
                                    <!--</div>-->
                                </form>
                            </div>
                            <div class="panel-footer text-center">
                                <button type="button" class="btn btn-success" ng-click="sendIndMessage()" id='sendIndMsgButton'
                                        type="submit">
                                    <span class="glyphicon glyphicon-send" aria-hidden="true"></span> Send
                                </button>
                                <!--<span class="input-group-btn"><button ng-click="sendIndMessage()" id='sendIndMsgButton'-->
                                                                      <!--type="submit" class="btn btn-default">Send to {{currentName}} </button></span>-->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<th:block th:replace="fragment/User/bottom">

</th:block>
